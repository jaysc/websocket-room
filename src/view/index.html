<html>

<body>

    <div id="app"></div>

    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>

    <!-- <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script> -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script type="text/babel">

        class App extends React.Component {
            constructor(props) {
                super(props);
                this.state = { data: "" };
                this.websocket = null;
            }

            setData = (newData) => {
                if (newData)
                {
                    this.setState({
                        data: this.state.data.concat("\n", newData)
                    })
                }
            }

            connectWs = () => {
                this.websocket = new WebSocket("ws://localhost:8080/ws", "protocolOne");

                this.websocket.onmessage = function (event) {
                    console.log("Received a message client")
                    this.setData(event.data)
                }.bind(this);

                return "Connected!";
            }

            joinRoom = () => {
                var msg = {
                    method: "JoinRoom",
                    data: {
                        name: "test"
                    }
                };

                this.websocket.send(JSON.stringify(msg));
            }

            render() {
                if (this.state.liked)
                {
                    return 'You liked this.';
                }

                return (<div>
                    <Connect connectWs={this.connectWs} setData={this.setData} />
                    <JoinRoom joinRoom={this.joinRoom} setData={this.setData} />
                    <ConsoleLog data={this.state.data} />
                </div>)
            }
        }

        function ConsoleLog(props) {
            const { data } = props;
            return (<pre>{data || "No Data"}</pre>)
        }

        function Connect(props) {
            const { connectWs, setData } = props;

            const handler = (event) => {
                event.preventDefault();
                let result = connectWs();
                setData(result)
            }

            return (
                <button type="button" onClick={handler}>Connect to WS</button>
            )
        }

        function JoinRoom(props) {
            const { joinRoom, setData } = props;

            const handler = (event) => {
                event.preventDefault();
                let result = joinRoom();
                setData(result)
            }

            return (
                <button type="button" onClick={handler}>Connect to WS</button>
            )
        }

        ReactDOM.render(React.createElement(App), document.getElementById('app'));
    </script>
</body>

</html>